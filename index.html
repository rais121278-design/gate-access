async function handleSubmit(e) {
    e.preventDefault();
    
    const uchastok = document.getElementById('uchastok').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const fio = document.getElementById('fio').value.trim();
    
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.textContent = 'ОБРАБОТКА...';
    submitBtn.disabled = true;
    
    try {
        const response = await fetch(
            `https://n8n.dewiar.com/webhook/6d28992b-ba37-4944-a5cc-f7bc3bc51e44?uchastok=${encodeURIComponent(uchastok)}&phone=${encodeURIComponent(phone)}&fio=${encodeURIComponent(fio)}`
        );
        
        const data = await response.json();
        
        if (data.found && data.status === 'В группе') {
            showSuccess(`Поздравляем, ${data.fio}! Ваши данные есть в базе. <br><a href="${data.group_link}" target="_blank" style="color: #4CAF50; text-decoration: underline;">Войти в чат</a>`);
        } else if (data.found) {
            showError('Ваш доступ находится на рассмотрении. Пожалуйста, дождитесь подтверждения.');
        } else {
            showError('Извините, ваши данные не совпадают с базой. Проверьте правильность введённых данных.');
        }
    } catch (error) {
        showError('Ошибка соединения. Попробуйте позже.');
    } finally {
        submitBtn.textContent = 'ПРОВЕРИТЬ ДОСТУП';
        submitBtn.disabled = false;
    }
}

function showSuccess(message) {
    const result = document.getElementById('result');
    result.innerHTML = `<div style="background: #4CAF50; color: white; padding: 20px; border-radius: 10px; margin-top: 20px;"><strong>✓ Доступ разрешён</strong><br>${message}</div>`;
}

function showError(message) {
    const result = document.getElementById('result');
    result.innerHTML = `<div style="background: #f44336; color: white; padding: 20px; border-radius: 10px; margin-top: 20px;"><strong>✗ Доступ запрещён</strong><br>${message}</div>`;
}
